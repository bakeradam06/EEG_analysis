
```{r}
# EEG analysis

################################################################################
####### CMC analysis, potenitally for dissertation, conference abstract ########
################################################################################

## load libraries
library(readr) # for reading csv files
library(dplyr) # for data manipulation
library(ggplot2) # for visualization
library(tidyr) # for data tidying
library(Hmisc)
# import CSV file with subject IDs and analyze CMC over time, as well as beta vs gamma, muscle, brain region, etc
# set working directory to folder with all step9 excel files
allData.df <- read_csv("/Users/DOB223/Library/CloudStorage/OneDrive-MedicalUniversityofSouthCarolina/Documents/lab/studies/1eeg/TNTanalysis/allDataForAnalyzeTNT.txt")
```

```{r}
## sanity check to assess if the import in matlab was done correctly

# first, check how many rows there are per subject
summary_by_subject <- allData.df %>%
    group_by(Subject) %>%
    dplyr::summarise(n_rows = n()) %>%
    arrange(n_rows)
# bar graph of it
ggplot(summary_by_subject, aes(x = Subject, y = n_rows)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    theme_minimal() +
    labs(
        title = "Rows per Subject",
        x = "Subject",
        y = "Number of Rows"
    )
```
################################################
########### descriptive statistics #############
################################################
```{r}
# basic descriptives of cmc_data_full
summary(allData.df)
describe(allData.df)

# check for missing values
missing_values <- sapply(allData.df, function(x) sum(is.na(x)))
print(missing_values)

# WMFT
ggplot(distinct(allData.df, Subject, .keep_all = TRUE), 
       aes(x = `WFMTavgTime`)) + 
  geom_histogram(binwidth = 10) +
  labs(
    title = "Distribution of WMFT PRE Average Scores",
    x = "WMFT PRE Average Score",
    y = "Number of Subjects"
  )
```

Add new variables: 
One that notes the connection, so don't have to add Muscle & BrainRegion to modeling.
Another few that note changes from pre to post in Coh, WMFTtime, as well as pre to FU. 
```{r}
allData.df <- allData.df %>%
  mutate(connection = factor(paste0(BrainRegion, '-', Muscle)))

# change scores - BNOT WORKING NEED TO KEEEP DOING
dWMFTpreFU <- allData.df %>%
  filter(session %in% c(`Baseline`, `FU 1`), !is.na(WFMTavgTime)) %>%
  group_by(Subject) %>%
  filter(n_distinct(session) == 2) %>%
  pivot_wider(names_from = session, values_from = WFMTavgTime) %>%
  mutate(dWFMTpreFU = `FU 1` - `Baseline`)

allData.df$dWFMTpreFU <- allData.df$WFMTavgTime["FU"] - allData.df$WFMTavgTime["Pre"] 
```
```{r - "How does CMC of PML-APB associate with baseline WMFT score during prep of grip?"}
# needs: 
  # baseline WMFT, CMC scores of prep phase, no execution phase here
  # keep beta, gamma, novib. Don't include Vib in this. Baseline only.

# exclude data i don't want (see above)
analysis1.df <- allData.df %>%
  filter(session == "Baseline", 
         Phase == "Prep", 
         Condition == "NoVib",
         BrainRegion == "PML") %>%
  group_by(Subject, connection) %>%
  summarise(meanCoh = mean(Coh), meanWMFT = mean(WFMTavgTime))


test1.df <- analysis1.df %>%
  filter(connection == "PML-APB")

model1 <- lm(meanWMFT ~ meanCoh,
   data = test1.df)
Anova(model1, type = 'III')

plot(test1.df$meanCoh, test1.df$meanWMFT)


allData.df %>%
  filter(Phase == "Prep", Condition == "NoVib") %>%
  ggplot(aes(x = WFMTavgTime, y = Coh, group_by = Subject)) +
  geom_point()
   
  


```


```{r - first model. looking at PML-APB connection for explaining motor recovery}
# question: does connection PML connectivity during grip preparation (-2 to 0s before grip) significantly help explain motor recovery? 

```



